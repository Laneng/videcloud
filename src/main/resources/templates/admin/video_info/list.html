<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<title>视频管理</title>
	<div th:replace="admin/common/common.html"></div>
	<!-- 导入Bootstrap样式 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">

</head>

<body>

<div th:replace="admin/common/nav.html"></div>

<div class="admin-iframe-content">
	<div class="admin-iframe-menu">
		<ul class="menu">
			<li ><a th:href="@{/admin/video/type}">分类管理</a></li>
			<li ><a th:href="@{/admin/video/check}">审核管理</a></li>
			<li class="active"><a th:href="@{/admin/video/info}">视频信息</a></li>
			<!--<li><a th:href="javascript:page('${pageContext.request.contextPath}/media_info/list_recycle.action');">回收站</a></li>-->
		</ul>
	</div>

	<!-- 面包屑导航和主体内容 -->
	<div class="content">
	<!--面包屑导航-->
	<div class="content-header">
		<div class="breadcrumb">
			<span>视频</span>
			<span class="divider">/</span>
			<span class="active">视频信息</span>
		</div>
	</div>

	<!--全部主体内容-->
	<div class="list-content">
		<!--块元素-->
		<div class="block">
			<!--页面有多个表格时，可以用于标识表格-->
			<h2>审核列表</h2>
			<a href="javascript:history.back();">
				<button class="button wathet" style="position: absolute;right: 20px;top: 16px;"><span class="icon-arrow_back"></span> 返回</button>
			</a>

			<!--正文内容-->
			<div class="main">
				<!--表格上方的操作元素，添加、删除等-->
				<div class="operation-wrap">
					<div class="buttons-wrap">
						<button class="button red" onclick="updateStatus('2');">
							<span class="icon-block"></span> 批量封禁
						</button>
						<button class="button green" onclick="updateStatus('1');">
							<span class="icon-check2"></span> 批量恢复
						</button>
						<button id="search" class="button yellow" onclick="sendSearchRequest()"><span class="icon-search2"></span> 类型搜索</button>
						<input id="text" class="button text" type="text">


					</div>
				</div>
				<table id="table" class="table">
					<thead>
						<tr>
							<th class="checkbox">
								<input type="checkbox" class="fill listen-1" />
							</th>
							<th>索引</th>
							<th>标题</th>
							<th>简介</th>
							<th>作者</th>
							<th>分类</th>
							<th>缩略图</th>
							<th>状态</th>
							<th>审核建议</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody id="type_result">
					<tr>
						<!--							<th class="checkbox"><input type="checkbox" class="fill listen-1" /> </th>-->
						<td> </td>
						<td> </td>
						<td> </td>
					</tr>
<!--					<th:block th:if="${#lists.isEmpty(pageInfo.list)}">-->
<!--						<tr>-->
<!--							<td colspan="8" style="text-align:center;">暂无记录</td>-->
<!--						</tr>-->
<!--					</th:block>-->
<!--					<th:block th:unless="${#lists.isEmpty(pageInfo.list)}">-->
<!--						<tr th:each="entity, status : ${pageInfo.list}">-->
<!--							<td class="checkbox"><input type="checkbox" class="fill listen-1-2" value="${entity.videoId}" name="videoId" /></td>-->
<!--							<td>-->
<!--								<div style="width:48px;height:24.8px;overflow:hidden;">-->
<!--									<a href="javascript:;" onclick="img(this)">-->
<!--										<img th:src="${entity.image}" width="100%" />-->
<!--									</a>-->
<!--								</div>-->
<!--							</td>-->
<!--							<td><input type="text" class="text" name="sort" th:value="${entity.sort}" th:data-type="非负整数" th:error-msg="请填写非负整数" th:error-pos="36" /></td>-->
<!--							<td th:text="${entity.num}"></td>-->
<!--							<td th:text="${entity.title}"></td>-->
<!--							<td th:text="${entity.viewCount}"></td>-->
<!--							<td>-->
<!--								<span th:if="${entity.status=='1'}" style="color:green;">正常</span>-->
<!--								<span th:unless="${entity.status=='1'}" style="color:red;">禁用</span>-->
<!--							</td>-->
<!--							<td>-->
<!--								<a href="javascript:;" onclick="video('${entity.num}', '${entity.videoId}')">-->
<!--									<button class="button wathet"><span class="icon-eye"></span> 预览</button>-->
<!--								</a>-->
<!--								<a th:href="@{/edit.action(videoId=${entity.videoId}, mediaId=${mediaId})}">-->
<!--									<button class="button wathet"><span class="icon-edit-2"></span> 编辑</button>-->
<!--								</a>-->
<!--							</td>-->
<!--						</tr>-->
<!--					</th:block>-->
					</tbody>
				</table>

				<!-- 分页 -->
<!--				<div class="page">-->
<!--					<ul id="page" class="pagination"></ul>-->
<!--				</div>-->
			</div>
		</div>
	</div>
</div>
</div>


<!-- 导入jQuery和Bootstrap的JavaScript文件 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

</body>

<script>

	$(function (){

	})

	function sendSearchRequest() {
		// 获取请求参数
		var type = $("#text").val(); // 从页面中获取输入的名称
		var pageNum = 1; // 设置页码
		var pageSize = 10; // 设置每页显示的数量

		console.log(type)
		// 发起Ajax请求
		$.ajax({
			url: '/vedioInfo/getByType', // 请求的URL
			type: 'GET', // 请求的方法
			data: {
				type: type,
				pageNum: pageNum,
				pageSize: pageSize
			}, // 请求的参数
			dataType: 'json', // 响应的数据类型
			success: function(result) {
				// 请求成功的处理逻辑
				console.log('请求成功', result);
				// 可以在这里根据返回的数据更新页面内容
				// 返回的数据是一个数组，包含多个对象
				var dataArray = result.data.list; // 数据在返回对象的 data 字段中
				var html = "";

				// 遍历数据数组，将每个对象添加为一行到表格中
				for (var i = 0; i < dataArray.length; i++) {
					html += "<tr>" +
							"<td><input class='fill listen-1' type='checkbox'></td>" +
							"<td>"+dataArray[i].id    +"</td>" +
							"<td>"+dataArray[i].title +"</td>" +
							"<td>"+dataArray[i].intro +"</td>" +
							"<td>"+dataArray[i].author+"</td>" +
							"<td>"+dataArray[i].type  +"</td>" +
							"<td>"+dataArray[i].img   +"</td>" +
							"<td>"+dataArray[i].state +"</td>" +
							"<td>"+dataArray[i].reason+"</td>" +
							"<td><button>修改</button></td>" +
							"</tr>"

				}
				$("#type_result").html(html);
			},
			error: function(xhr, textStatus, errorThrown) {
				// 请求失败的处理逻辑
				console.log('请求失败', errorThrown);
				// 可以在这里处理请求失败的情况，例如显示错误信息
			},
			complete: function() {
				// 请求完成的处理逻辑，无论成功或失败都会执行
				console.log('请求完成');
				// 可以在这里隐藏加载器等操作
			}
		});

	// 根据视频分类查询视频信息(需要绑定"搜索"按键的事件)
	function searchByType() {
		var type = $('#type').val(); // 获取输入的视频分类
		var page = 1; // 设置当前页数
		var limit = 10; // 设置每页显示条数
		$.ajax({
			url: '/vedioInfo/getByType',
			type: 'get',
			dataType: 'json',
			data: {
				'page': page,
				'limit': limit,
				'type': type
			},
			success: function (result) {
				// 处理查询结果
				if (result.code === 200) {
					// 渲染视频信息到页面
					// ...
				} else {
					// 处理错误情况
					// ...
				}
			},
			error: function () {
				// 处理请求失败情况
				// ...
			}
		});
	}

	// 更新视频信息的请求
	function updateVedioInfo(id, state, reason) {
		$.ajax({
			url: '/vedioInfo/update',
			type: 'POST',
			data: {
				id: id,
				state: state,
				reason: reason
			},
			success: function(data) {
				// 请求成功处理逻辑
				console.log(data);
				// 根据后端返回的数据进行相应的处理
				if (data.status === 200) {
					// 更新成功，进行页面跳转或其他操作
					alert("已完成审核");
					window.location.href = "/vedioInfo/getAll"; // 页面跳转到视频列表页面
				} else {
					// 更新失败，提示错误信息或其他操作
					alert("审核过程出错啦：" + data.message);
				}
			},
			error: function(error) {
				// 请求失败处理逻辑
				console.error(error);
				// 处理请求失败的情况，例如提示用户重试或其他操作
				alert("请求失败，请重试：" + error.statusText);
			},

		});
	}

	// 更新视频状态为审核已通过，违规原因为"符合社会主义核心价值观"
	updateVedioInfo(1, 1, "符合社会主义核心价值观");

	// 更新视频状态为审核未通过，违规原因为"色情低俗"
	updateVedioInfo(2, 2, "色情低俗");

	// 更新视频状态为默认未审核
	updateVedioInfo(3, 0, "");
	}


</script>
</html>
